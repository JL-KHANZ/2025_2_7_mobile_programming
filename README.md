==========================================
Sol-Eat README  
==========================================
0. 참고
------------------------------------------
GitHub: https://github.com/JL-KHANZ/2025_2_7_mobile_programming
Android 지원 버전
-최소 지원: Android 7.0 Nougat (API Level 24) 이상
-권장: Android 16 Baklava (API Level 36)


1. 프로젝트 소개
------------------------------------------
이 프로젝트는 사용자의 감정 기반 일기 분석과  
이를 활용한 감정 매칭·채팅 기능을 제공하는  
감정 케어 & 소셜 매칭 서비스입니다.

사용자는 일기를 작성하면 AI 분석 결과와 함께  
오늘의 대표 감정을 얻고,  
이 감정을 기반으로 공감할 수 있는 상대를 찾아  
실시간 채팅을 진행할 수 있습니다.



2. 주요 기능
------------------------------------------
- 회원가입 / 로그인  
- 사용자 프로필 관리  
- 일기 작성 & AI 감정 분석 저장  
- 감정 기반 매칭(최대 5명 후보 제공)  
- 실시간 1:1 채팅  
- 오래된 데이터 자동 정리(백그라운드 스케줄러)
- 캘린더 기반 일기, 감정 분석 조회(날짜별 탐색)



3. 프로젝트 구조
------------------------------------------
본 프로젝트는 Android App + Firebase Backend로 구성됩니다.

[Frontend : Android]
- UI 화면 구성
- 사용자 입력 처리
- 서비스 호출 및 응답 표시
- 실시간 채팅 UI 관리

[Backend : Firebase]
- Authentication : 사용자 인증
- Firestore : 사용자 정보, 일기, 매칭 데이터 저장
- Realtime Database : 실시간 채팅 메시지 저장
- Cloud Storage : 프로필 이미지 저장
- Cloud Functions : 매칭·방생성·정리 로직 수행

[AI : Gemini AI API 2.5 FLASH]
- 모델: gemini-2.5-flash 모델을 사용하여 비용 효율성과 빠른 응답 속도를 확보
- 피드백 생성: 사용자가 작성한 일기 내용을 바탕으로 공감, 마인드셋 방법, 생활 루틴을 포함한 피드백을 생성
- 감정 분석: 일기 내용에서 로버트 플루치크의 8가지 기본 감정을 추출하고 점수를 매겨 사용자의 주요 감정을 분석
- 결과 파싱: Gemini AI가 생성한 텍스트(JSON)를 파싱하여 앱에서 사용할 수 있는 데이터 객체로 변환

4. 설치 및 실행 방법
------------------------------------------

[Android 앱 실행]
1) Android Studio에서 프로젝트 열기
2) `/app` 폴더에 `google-services.json` 존재 여부 확인
3) 필요 시 Firebase 콘솔에서 json 재다운로드하여 덮어쓰기
4) 에뮬레이터 또는 실제 기기로 실행

[Firebase 연결]
- Firestore / Authentication / Realtime DB / Storage / Functions 활성화 필요
- 콘솔에서 각 서비스의 보안 규칙 적용 필요
- Node.js 설치 필요

※ 주의: json 파일 이름 변경 금지  
※ 하나의 json 파일만 존재해야 정상 동작함


5. 백엔드 데이터 구조 (요약)
------------------------------------------
users/{uid}/profile/info  
  - 사용자의 기본 정보 저장

users/{uid}/dailyEntry/{yyyy-MM-dd}  
  - 일기 + AI 분석 + 감정 데이터 저장  
  - topEmotion 사용하여 매칭 수행

matchTickets/{ticketId}  
  - 감정 매칭 대기열 티켓

chatRooms/{roomId}  
  - 생성된 채팅방 기본 정보

chatMessages/{roomId}/{messageId}  
  - 실시간 메시지 저장 (RTDB)



6-1. 백엔드 핵심 서비스 요약
------------------------------------------

[UserService]
- 기본 프로필 생성
- 사용자 프로필 수정 및 저장
- 프로필 조회

[DailyEntryService]
- 일기 및 분석 데이터 저장
- 날짜 범위 조회

[MatchService]
- 오늘 감정을 기반으로 매칭 티켓 생성
- 후보자 5명 반환(Cloud Function 호출)

[ChatRoomService]
- 상대방 선택 시 채팅방 생성
- 활성 채팅방 조회

[ChatMessageService]
- 실시간 메시지 송신/수신
- 리스너 등록 및 해제


6-2 백엔드 Cloud Functions 요약
------------------------------------------
- requestMatch : 매칭 티켓 생성 + 후보자 반환
- createChatRoom : 채팅방 생성 + 티켓 상태 업데이트
- getActiveRoom : 사용자 활성 채팅방 조회
- cleanupOldRooms : 일자별 오래된 채팅 데이터 자동 삭제 (스케줄러)



7. 프론트엔드 구조
------------------------------------------
[화면 구성]
- Daily Activity(일기 작성/분석 결과 조회)
- Chat(1:1 채팅)
- Profile(프로필 조회/편집)
- Calendar(월별 일기/분석 결과 조회)

[Navigation 구조]
- Bottom Navigation 구조 및 Fragment 기반 화면 전환


8. 역할 분담
------------------------------------------
[Frontend]
- 캘린더 날짜 클릭 기반 상세 조회 흐름 구성
- 프로필, 계정 관리 기능 연동
- 감정 컬러 매핑 로직 구현

[Backend]
- Firebase 아키텍처 설계
- Firestore / RTDB 데이터 모델 정의
- Cloud Functions 구현
- 서비스 API 구현(User/Daily/Match/Chat)
- 보안 규칙 설정 및 데이터 관리 로직 작성

[AI]
- AI API 연결
- AI 감정 분석
- 로버트 플루치크 이론 기반 파생 감정 조합
- AI 감정 개선 피드백 제공

[UI]
- 캘린터 날짜 셀 레이아웃 설계
- 프로필 화면 이미지/텍스트 레이아웃 설계


9. 주요 설계 포인트
------------------------------------------
[Frontend]
- 날짜 기반 일기 데이터 구조와 일치하도록 캘린더 UI를 설계
- emotion dot + 컬러 매핑을 통해 월별 감정 흐름을 파악하도록 UX 제공
- 계정 정보 조회 및 변경 기능을 앱 내에서 처리하도록 사용자 관리 흐름을 통합


[Backend]
- 모든 서비스는 로그인된 사용자만 접근 가능하게 설계됨  
- 문서 생성/변경 시 서버 타임스탬프로 데이터 품질 보존  
- DailyEntry는 최근 3개월만 유지하여 데이터 과도 증가 방지  
- 채팅방 및 메시지는 dayKey 기반으로 저장 후  
  매일 예약 스케줄러가 오래된 데이터를 정리  
- API는 Task 기반 비동기 방식으로 UI 응답성 유지

[AI]
- API 요청 실패 시(서버 오류 등), 지수 백오프(Exponential Backoff) 전략을 
적용한 재시도 로직을 구현하여 응답 성공률을 높힘. 
최대 3회까지 자동으로 재시도하고 서버 부하를 줄이기 위해 재시도 간 대기 시간을 점진적으로 늘림.
- AI의 응답에 포함될 수 있는 불필요한 마크다운(``` json)이나 텍스트를 
제거하는 extractJson 로직을 구현하여 다양한 응답 형태에도 안정적으로 JSON 데이터를 추출하도록 설계
- 감정 분석 결과에서 가장 높은 점수를 받은 두 감정의 점수 차이가 작을 경우(5.0 미만) 
두 감정을 조합하여 파생감정을 도출하도록 설계
- ListenableFuture와 콜백(Callback)을 사용하여 AI API 호출이 
메인 스레드를 차단하지 않고 비동기적으로 처리되도록 하여 UI의 응답성을 유지

10. 주의 사항
------------------------------------------
[Frontend]
■ 프로필 이미지 업로드/표시는 Storage 권한 및 네트워크 상태에 영향을 받을 수 있습니다.

[Backend]
■ google-services.json이 없으면 앱이 실행되지 않습니다  
■ Firestore/RealtimeDB 보안 규칙 설정이 반드시 필요합니다  
■ Functions 배포 후 로직 변경 시 `firebase deploy` 재수행 필수  
■ Cloud Functions은 최초 배포 시 시간이 다소 걸릴 수 있습니다

[AI]
■ API 호출에 일시적인 오류가 있을 수 있습니다.(서버 과부하) -> 3회 재시도 기능 구현
■ 일기의 길이가 길수록 감정분석 정확도가 올라갑니다.

11. 버전 정보
------------------------------------------
v1.0.0  
- 기본 일기 관리 기능  
- 감정 분석 저장  
- 매칭 서비스(5명 후보)  
- 실시간 채팅 기능 추가  
- 데이터 자동 정리 작업 포함



12. 문의 / 유지보수
------------------------------------------
Frontend 담당 : sorichang03@gmail.com(이재창)
Backend 담당 : 9wkdbs@gmail.com (구자윤)  
AI 담당 : k0207y@naver.com (이기서)

==========================================
  END OF README
==========================================

